<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Buildings in Kitsap by Year Built</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id='map'></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidW5jaGVja2VkZXJyb3IiLCJhIjoiTkNzaWFqOCJ9.fqhZgsGh60h8OdWjVqbYhg';

        // Set bounds to New York, New York
        var bounds = [
            [-123.1, 47.3], // Southwest coordinates
            [-122.3, 48.0]  // Northeast coordinates
        ];

        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/uncheckederror/cjzt6r50u0o901coglv25vfen', // stylesheet location
            center: [-122.584744, 47.543532], // starting position [lng, lat]
            pitch: 60.00, // pitch in degrees
            bearing: -39.20, // bearing in degrees
            zoom: 12, // starting zoom
            maxBounds: bounds // Sets bounds as max
        });

        map.on('style.load', function () {

            // Add the buildings layer to the map.
            map.addSource('buildings', {
                "type": "vector",
                "url": "mapbox://uncheckederror.0oi5qhmz"
            });

            map.addLayer({
                "id": "Buildings",
                "type": "fill",
                "source": "buildings",
                "source-layer": "YearStories-0ta6xz",
                "minzoom": 13,
            });
        });

        // Create a popup, but don't add it to the map yet.
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // When a click event occurs on a feature in the states layer, open a popup at the
        // location of the click, with description HTML from its properties.
        map.on('click', 'Buildings', function (e) {
            let pdetails = "Built in " + e.features[0].properties.YEAR_BUILT;
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(pdetails)
                .addTo(map);
        });

        // Change the cursor to a pointer when the mouse is over the parcel layer.
        map.on('mouseenter', 'Buildings', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map.on('mouseleave', 'Buildings', function () {
            map.getCanvas().style.cursor = '';
        });

    </script>
</body>

</html>